<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Village Interest Share</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Telugu', sans-serif; background-color: #f0f2f5; }
        
        /* Card Styles matching your design */
        .result-card {
            background-color: white;
            width: 100%;
            max-width: 380px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            margin: 0 auto;
        }
        .card-header { padding: 20px; display: flex; align-items: center; gap: 10px; }
        .logo-text { color: #f37021; font-weight: bold; font-size: 18px; line-height: 1.2; }
        .card-title { padding: 0 20px; font-size: 14px; color: #333; font-weight: normal; margin-bottom: 20px; }
        .account-num { color: #f37021; font-weight: bold; }
        .content-grid { display: grid; grid-template-columns: 1fr 1fr; padding: 0 20px 20px 20px; gap: 15px; }
        .grid-item { display: flex; flex-direction: column; }
        .label { font-size: 11px; color: #000; font-weight: bold; margin-bottom: 4px; text-transform: uppercase; opacity: 0.7; }
        .value { font-size: 14px; color: #f37021; font-weight: bold; }
        .card-footer { background-color: #1a2b4a; color: white; text-align: center; padding: 15px; font-size: 10px; margin-top: 10px; }
        
        input[type="date"] { -webkit-appearance: none; position: relative; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen py-6 text-gray-800">

    <div class="w-full max-w-md px-4 mb-4 text-center">
        <h1 class="text-2xl font-bold text-[#1a2b4a]">Village Interest Calculator</h1>
        <p class="text-gray-500 text-xs">Enter details & Share Image</p>
    </div>

    <!-- Inputs -->
    <div class="w-full max-w-md bg-white rounded-xl shadow-sm border border-gray-200 p-5 space-y-5 mb-8">
        <div class="flex bg-gray-100 p-1 rounded-lg">
            <button id="btnSimple" onclick="setInterestType('simple')" class="flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all duration-200 bg-white text-[#f37021] shadow-sm">సాధారణ వడ్డీ</button>
            <button id="btnCompound" onclick="setInterestType('compound')" class="flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all duration-200 text-gray-500 hover:text-gray-700">చక్ర వడ్డీ</button>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-xs font-bold text-gray-700 mb-1 ml-1">అప్పు (Principal Amount)</label>
                <input type="number" id="principal" placeholder="Ex: 12000" oninput="calculate()" class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#f37021] focus:border-transparent outline-none font-semibold text-gray-800">
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-700 mb-1 ml-1">వడ్డీ రేటు (Rate per Month)</label>
                <input type="number" id="rate" placeholder="Ex: 2.30" oninput="calculate()" class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#f37021] focus:border-transparent outline-none font-semibold text-gray-800">
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-1 ml-1">Start Date</label>
                    <input type="date" id="startDate" onchange="calculate()" class="w-full px-2 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#f37021] outline-none text-sm font-medium">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-1 ml-1">End Date</label>
                    <input type="date" id="endDate" onchange="calculate()" class="w-full px-2 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#f37021] outline-none text-sm font-medium">
                </div>
            </div>
        </div>
        
        <div class="flex justify-end pt-2">
             <button onclick="resetFields()" class="text-gray-400 hover:text-red-500 text-xs font-bold uppercase tracking-wider transition-colors">Reset</button>
        </div>
    </div>

    <!-- Hidden Wrapper for Capture -->
    <div id="resultSection" class="w-full px-4 mb-24 hidden">
        <div id="captureCard" class="result-card">
            <div class="card-header">
                <div style="background-color: #f37021; width: 30px; height: 30px; border-radius: 5px 20px 0 20px;"></div>
                <div class="logo-text">INTEREST CALCULATOR<br><span style="font-size: 12px; color: #666; font-weight: normal;">Private Finance</span></div>
            </div>
            <div class="card-title">Summary of the Loan details <span class="account-num">#<span id="yearId">2026</span></span></div>
            <div class="content-grid">
                <div class="grid-item"><div class="label">Principal Amount (అప్పు)</div><div class="value" id="cardPrincipal">Rs. 0</div></div>
                <div class="grid-item"><div class="label">Rate of Interest</div><div class="value" id="cardRate">Rs. 0 / Month</div></div>
                <div class="grid-item"><div class="label">Start Date</div><div class="value" id="cardStart">--/--/----</div></div>
                <div class="grid-item"><div class="label">Tenure (కాలం)</div><div class="value" id="cardTenure">0 Months</div></div>
                <div class="grid-item"><div class="label">End Date</div><div class="value" id="cardEnd">--/--/----</div></div>
                <div class="grid-item"><div class="label">Interest Type</div><div class="value" id="cardType">Simple Interest</div></div>
                <div class="grid-item"><div class="label">Total Interest (వడ్డీ)</div><div class="value" id="cardInterest">Rs. 0</div></div>
                <div class="grid-item"><div class="label">Total Amount Due</div><div class="value" style="font-size: 18px; color: #1a2b4a;" id="cardTotal">Rs. 0</div></div>
            </div>
            <div class="card-footer">Generated by Interest Calculator App. All calculations verified.</div>
        </div>
    </div>

    <!-- Share Button (Fixed Bottom) -->
    <div id="shareBtnContainer" class="hidden fixed bottom-6 left-0 right-0 px-4 z-50">
        <button onclick="shareImage()" class="w-full max-w-sm mx-auto bg-[#25D366] hover:bg-[#128C7E] text-white font-bold py-4 rounded-xl shadow-2xl flex items-center justify-center gap-3 active:scale-95 transition-all text-lg border-2 border-white/20">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654z"/></svg>
            Share Image on WhatsApp
        </button>
        <p class="text-center text-xs text-gray-400 mt-2 font-medium">Direct Share works on Mobile Only</p>
    </div>

    <script>
        let currentType = 'simple';

        window.onload = function() {
            document.getElementById('endDate').valueAsDate = new Date();
            const year = new Date().getFullYear();
            document.getElementById('yearId').innerText = year + "-" + (year+1).toString().slice(-2);
        };

        function setInterestType(type) {
            currentType = type;
            const btnSimple = document.getElementById('btnSimple');
            const btnCompound = document.getElementById('btnCompound');
            if (type === 'simple') {
                btnSimple.className = "flex-1 py-2 px-4 rounded-md text-sm font-bold bg-white text-[#f37021] shadow-sm";
                btnCompound.className = "flex-1 py-2 px-4 rounded-md text-sm font-bold text-gray-500";
            } else {
                btnSimple.className = "flex-1 py-2 px-4 rounded-md text-sm font-bold text-gray-500";
                btnCompound.className = "flex-1 py-2 px-4 rounded-md text-sm font-bold bg-white text-[#1a2b4a] shadow-sm";
            }
            calculate();
        }

        function calculate() {
            const principal = parseFloat(document.getElementById('principal').value);
            const rate = parseFloat(document.getElementById('rate').value);
            const startDateVal = document.getElementById('startDate').value;
            const endDateVal = document.getElementById('endDate').value;

            if (!principal || !rate || !startDateVal || !endDateVal) {
                document.getElementById('resultSection').classList.add('hidden');
                document.getElementById('shareBtnContainer').classList.add('hidden');
                return;
            }

            const start = new Date(startDateVal);
            const end = new Date(endDateVal);
            if (end < start) return;

            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            let days = end.getDate() - start.getDate();

            if (days < 0) { months--; days += new Date(end.getFullYear(), end.getMonth(), 0).getDate(); }
            if (months < 0) { years--; months += 12; }

            let durationString = "";
            if (years > 0) durationString += `${years} Y `;
            if (months > 0) durationString += `${months} M `;
            if (days > 0) durationString += `${days} D`;
            if (durationString === "") durationString = "0 Days";

            const totalMonths = (years * 12) + months + (days / 30);
            let interest = 0, totalAmount = 0;

            if (currentType === 'simple') {
                interest = (principal * rate * totalMonths) / 100;
                totalAmount = principal + interest;
            } else {
                totalAmount = principal * Math.pow((1 + rate / 100), totalMonths);
                interest = totalAmount - principal;
            }

            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('shareBtnContainer').classList.remove('hidden');

            const fmt = (num) => "Rs. " + num.toLocaleString('en-IN', { maximumFractionDigits: 0 });
            const dateFmt = (d) => d.split('-').reverse().join('-');

            document.getElementById('cardPrincipal').innerText = fmt(principal);
            document.getElementById('cardRate').innerText = `Rs. ${rate} / Month`;
            document.getElementById('cardStart').innerText = dateFmt(startDateVal);
            document.getElementById('cardEnd').innerText = dateFmt(endDateVal);
            document.getElementById('cardTenure').innerText = durationString;
            document.getElementById('cardType').innerText = currentType === 'simple' ? 'Simple Interest' : 'Compound Interest';
            document.getElementById('cardInterest').innerText = fmt(Math.round(interest));
            document.getElementById('cardTotal').innerText = fmt(Math.round(totalAmount));
        }

        // --- DIRECT SHARE LOGIC ---
        async function shareImage() {
            const card = document.getElementById('captureCard');
            const btn = document.querySelector('#shareBtnContainer button');
            const originalText = btn.innerHTML;
            btn.innerHTML = "Generating Image..."; // Feedback

            try {
                // 1. Generate Image Blob
                const canvas = await html2canvas(card, { scale: 2, backgroundColor: "#ffffff" });
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                const file = new File([blob], "loan_summary.png", { type: "image/png" });

                // 2. Check for Web Share API support
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    // 3. Open Native Share Sheet (Select WhatsApp here)
                    await navigator.share({
                        files: [file],
                        title: 'Loan Summary',
                        text: 'Here is the loan summary card.'
                    });
                } else {
                    // Fallback for Desktop: Download
                    alert("Mobile Share not supported on this browser. Downloading image instead.");
                    const link = document.createElement('a');
                    link.download = 'loan_summary.png';
                    link.href = canvas.toDataURL();
                    link.click();
                }
            } catch (error) {
                console.error("Sharing failed", error);
                alert("Sharing failed. Try a different browser.");
            } finally {
                btn.innerHTML = originalText;
            }
        }

        function resetFields() {
            document.getElementById('principal').value = '';
            document.getElementById('rate').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('shareBtnContainer').classList.add('hidden');
        }
    </script>
</body>
</html>

